<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Improving inference of metacommunity structure using multi-species occupancy models</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>



<!-- MathJax scripts -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



</head>

<body>
<h1>Improving inference of metacommunity structure using multi-species occupancy models</h1>

<h4>Authors</h4>

<p>Joseph R. Mihaljevic$<sup>1\[ ^*$, Maxwell B. Joseph$^1$, Pieter T.J. Johnson$^1$

$^1$ *Department of Ecology and Evolutionary Biology, University of Colorado, Boulder, CO, 80309*

$^*$ *Corresponding Author*

\newpage

Abstract
------------------
Blah blah blah

Introduction
-------------------

Broadly speaking, the metacommunity concept seeks to understand how spatial patterns of community composition emerge as a product of both local (e.g. competition) and regional (e.g. dispersal) dynamics [@Leibold2004; @Chase2005; @Holyoak2005]. To date, metacommunity research can be separated into two nearly distinct categories: mechanism-based approaches and pattern-based approaches. The mechanism-based approach employs mechanistic modeling or controlled experiments to generate and test hypotheses related to, for example, the distribution of species across local sites [@Holyoak2005; @Cottenie2005; @Urban2009; @Logue2011; @Pillai2011; @Economo2011; @Carrara2012]. The pattern-based approach uses an inverse process, attempting to relate empirically observed patterns of species occurrences across a landscape to structuring mechanisms [@Leibold2002; @Presley2010; @Presley2010a; @Lopez-Gonzalez2012; @Henriques-Silva2013; @Meynard2013]. While both approaches have advanced understanding of community structure and its underpinnings, methodological improvements can be developed to better integrate these disparate lines of research. Improving metacommunity analytic tools could therefore lead to a more complete understanding of community patterns and structuring mechanisms.  

The pattern-based metacommunity approach, often referred to as the 'elements of metacommunity structure' (EMS) paradigm, relies on observed occurrences of species among 'patches' of habitat in the metacommunity (e.g. field sampling sites). This data is typically compiled into a species-by-site incidence matrix and statistical procedures are run to determine if the metacommunity exhibits any of twelve unique structures [@Leibold2002; @Presley2010]. Based on the specific structure observed, inferences are made as to how the metacommunity assembles along dominant environmental axes. 
However, the efficacy of this pattern-to-process approach depends heavily upon the quality of the observed data. For instance, problems with species detection could lead to inaccurate incidence matrices and, therefore, inaccurate assessments of metacommunity structure. 
Fortunately, decades of advancements in occupancy modeling have led to powerful methods that deal with problems such as species detectability. Integrating occupancy modeling with the pattern-based EMS paradigm should improve our ability to assess metacommunity structure and the associated inferences about structuring processes.

Occupancy modeling relies on repeated sampling surveys to distinguish between the probability of a species occurring at a site and the probability of a species being detected at a site in which it occurs [@MacKenzie2002]. These models facilitate estimation of the effects of covariates on detection and occurrence probabilities. Recently, dynamic multi-species occupancy models have been developed for use with longitudinal data sets to better estimate aspects of metacommunity structure, such as alpha, beta and gamma diversity metrics, as well as species-, site- and time-specific covariate effects on occurrence probabilities [@Dorazio2010; @Burton2012]. For instance, Dorazio et al. (2010) also specifically identify a closer union of their modeling framework with metacommunity theory as a priority in the field. While the integration of occupancy modeling with metacommunity theory is nascent, there is enormous potential to improve the study of metacommunity dynamics.

In this article, we will highlight some of the difficulties with current EMS methods and emphasize how integrating assessment of EMS with occupancy modeling will help to resolve these issues. We will also illustrate unique advantages of occupancy modeling that will complement the EMS paradigm. First, we will begin by briefly reviewing the methods involved in the analysis of EMS and the structuring of multi-species occupancy models. Next, we will verbally outline various problems or advantages and couple these explanations with illustrative figures generated with simulated data sets. Our motivation for this article is to highlight the breadth of utilities gained by integrating these two approaches, rather than to explore any specific question or topic in great detail. We have also made our modeling and simulation code publicly available and fully annotated so that these methods can be appropriately and broadly utilized. We believe our approach will lead to a more complete exploration of metacommunity structure and its underpinning mechanisms from occurrence data sets.

Elements of metacommunity structure
-------------------------------------

The EMS paradigm follows a step-wise procedure to determine which of twelve potential metacommunity structures are exhibited by a data set of species occurrences observed across multiple sites. Although the procedure can determine that no orderly structure exists (i.e. random structure), most metacommunities seem to exhibit detectable structure. In this section we will only briefly describe the methods used to identify metacommunity structure within the EMS paradigm, as these methods have been detailed extensively elsewhere [@Leibold2002; @Presley2010]. 

Species occurrence data are assembled into a site x species incidence matrix with rows as sites and columns as species. This matrix is then ordinated, typically using reciprocal averaging, to simultaneously group sites with common species assemblages and species with common distributions among sites. This ordinated incidence matrix theoretically represents how species assemblages are structured along a dominant environmental axis (i.e. gradient) across sites. From this matrix statistics are then calculated to summarize the elements of metacommunity structure. 

The first and most important metric of metacommunity structure is coherence, which represents whether the majority of species in the metacommunity respond to the same dominant environmental gradient as a cohesive unit, the foundation of structure. Coherence is estimated using the number of embedded absences in the ordinated matrix. Embedded absences occur in areas of the matrix where a species is absent in a site in which it would be expected to occur based on the ordination. The observed number of embedded absences are then compared to a distribution of embedded absences generated from simulated null matrices. When the metacommunity exhibits fewer embedded absences than expected from random chance (as defined by the method of simulating null matrices), the metacommunity is said to exhibit positive coherence. If the metacommunity has more embedded absences than expected, there is evidence for a checkerboard pattern. Finally, if the number of embedded absences is not significantly different from random, the metacommunity is not coherent and exhibits no discernible structure. This is often interpreted as meaning that species in the metacommunity respond to different dominant environmental gradients or that the size of the matrix (in terms of the number of sites or species or observed occurrences within the matrix) is too small to detect patterns.

If a metacommunity exhibits positive coherence, two more metrics are calculated to further describe the metacommunity structure, the first being turnover. Turnover represents how species composition changes along the theoretical environmental gradient, estimated using the number of species replacements observed in the ordinated matrix. Again, this observed number is compared to a distribution generated with simulated null matrices. If the number of replacements is fewer than expected, the metacommunity exhibits negative turnover, which is indicative of nested subsets. If the number of replacements is grater than expected, the metacommunity exhibits clumps of species. Finally, if there is no significant turnover, various quasi-structures are assigned to the metacommunity, depending on the outcome of the final metacommunity structure metric, boundary clumping [*sensu* @Presley2010]. 

Boundary clumping, estimated with Morista's index, helps to distinguish between clumped structures or helps to determine the way nested subsets are organized. If a metacommunity is positively coherent and clumped, and there is positive boundary clumping, the metacommunity is said to exhibit a Clementsian structure. This means that distinct species groupings emerge along the gradient (e.g. intermediate and climax communities). In this case, the ordinated structure may be the result of multimodal species-specific responses to an environmental gradient. In other words, subsets of species respond similarly as one another to the gradient, but differently from other subsets of species. Alternatively, if there is no discernible boundary clumping, the metacommunity is said to exhibit a Gleasonian structure, where species respond idiosyncratically to the environmental gradient, for example, as a unimodal distribution of responses. Negative boundary clumping is indicative of evenly spaced species assemblages. 

If a metacommunity is positively coherent and exhibits nested subsets, and there is positive boundary clumping, the metacommunity shows clumped species losses along the environmental gradient. For example, a plant assemblage may show subsets along an environmental gradient, but ecotypes emerge leading to clumped assemblages [@Presley2010]. If there is no evidence for boundary clumping, this is indicative of random species losses along the gradient. Finally, if there is negative boundary clumping, this shows evidence for hyperdispersed (evenly spaced) species losses. In this case, species loss is more or less predictable along the environmental gradient.

After the metacommunity structure is discerned using these three metrics, studies typically seek to determine which environmental covariates might be the responsible structuring gradient. This analyses takes various forms. In most cases, the ordination score for each sampled site is extracted from the incidence matrix. Then correlation coefficients are calculated for each covariate of interest and subsequently researchers theorize how significantly correlated covariates might be responsible for structuring the metacommunity (**citations**). Another, related approach is to use, for example, canonical correspondence analysis to relate site ordination scores to multiple covariates simultaneously (**citations**). A more recent approach is to combine one of these previously discussed analyses with a variance partitioning analysis to evaluate the relative contribution of classes of covariates, such as 'local' and 'spatial' or 'abiotic' and 'biotic' (**citations**). 

Although these methods have yielded various insights into the structuring of metacommunities, at each step of this process, there are problems that can arise due to the methods themselves, such as type II error inflation, or due to inherent issues in data quality, such as detection errors. Below, we will briefly describe the structure of multi-species occupancy models, which estimate detection and occurrence probabilities and associate these probabilities with covariates, all within the same model. Next, we will highlight various issues with the EMS that can be ameliorated using occupancy modeling and then describe the unique features of the models that can complement the EMS paradigm. 

Multi-species occupancy models
-------------------------------------

Species occupancy models were developed to estimate a species' probability of occurring within a site while correcting for the fact that there is inherent error in detection, and therefore the species may be present but go undetected in a survey. To overcome this hurdle, occupancy models using data from multi-observation surveys can disentangle detection and occurrence probabilities to better estimate species presences and absences. More recently, these models have been extended to multi-species and multi-timepoint (longitudinal) surveys. In these models, species-, site- and time-specific estimates of detection probability, occurrence probability and covariate effects can be estimated. Additionally, with longitudinal surveys, the probabilities of persistence at a site and colonization of previously unoccupied sites can be estimated. All of these models estimate parameters in the Bayesian framework. Here, for simplicity, we will describe the structure of a single timepoint, multi-species occupancy model with mulitple observations at each site over the single time period (e.g. multiple surveys within one month). This same model will be used for all of our subsequent simulations and analyses.  

Let $z_{i,k}$ represent the true occurrence of species *i* at site *k*, where $z_{1,1}=1$ means that Species 1 is present at Site 1. This true occurrence is estimated as a Bernouli trial with probability, $\psi_{i,k}$, the probability of occurrence: 
 \]</sup> z<em>{i,k} \sim Bern(\psi</em>{i,k}) \[ 

The probability of occurrence, $\psi_{i,k}$, can be related to any number of covariates as follows:
 \] logit(\psi<em>{i,k}) = \alpha</em>{i0} + \alpha<em>{i1}X</em>{k1} + \dots + \alpha<em>{iC}X</em>{kC} \[ ,
where *C* is the number of covariates, $\alpha_{ic}$ is the species-specific effect of covariate *c*, $\alpha_{i0}$ is the species-specific baseline occurrence probability, and $X_{kc}$ is the value of covariate *c* at site *k*. 

Observations of each species at each site are accumulated over a series of observations within the given time-frame. For example, if Species 1 is observed in five total surveys at Site 2, $Y_{1,2}=5$. These observations, however, have inherent error in detectability. Let $\rho_{i,k}$ represent the species- and site-specific probability of detection. Again, the probabilities of detection can be influenced by site-level covariates. These covariates can be the same as or unique from the covariates influencing occurrence proabilities:
 \] logit(\rho<em>{i,k}) = \beta</em>{i0} + \beta<em>{i1}X</em>{k1} + \dots + \beta<em>{iC}X</em>{kC} \[ 

The observed occurrences are thus binomially distributed, influenced by both the detection and occurrence probabilities and the number of surveys conducted at each site, $J_{k}$:
 \] Y<em>{i,k} \sim Binom(J</em>{k}, z<em>{i,k}\rho</em>{i,k}) $$</p>

<p>Depending on how many sites were sampled and how many species are observed, estimating all of these species- and site-specific parameters can be computationally expensive. In order to optimize parameter estimation, metacommunity-level hyperparameters are estimated in a heirarchical Bayesian framework. Thus, species- and site-level parameters are drawn from the metacommunity-level distribution of parameter values. In all of the follwoing analyses, we used R (<strong>citation</strong>) and JAGS (<strong>citation</strong>), via the R package &#39;rjags&#39; (<strong>citation</strong>). </p>

<h2>Difficulties with the EMS paradigm</h2>

<p>A large assumption that the EMS strategy makes is that the collected data do not suffer from problems with detection. However, presence/absence data are inherently flawed by observation error. This observation or detection error can influence the ordination of the community matrix, the calculated EMS metrics, and the accuracy of structural inference based on null matrices. For example, if species detection is imperfect, the calculated number of embedded absences from the ordinated matrix may be overestimated, which could lead to type II errors where metacommunities are incorrectly assigned random structures. Additionally, imperfect detection influences the construction of null matrices. Depending on the method used to generate these null matrices, type I or type II errors are of concern (<strong>citation</strong>), and detection problems can enhance these issues. The occupancy modeling framework can circumvent this problem by estimating true occupancy of each species at each site, \( z_{i,k} \). </p>

<p>With the Bayesian approach to occupancy modeling, Gibbs sampling is used to create a distribution of posterior estimates for each \( z_{i,k} \). These \( z_{i,k} \) values can be assembled into an incidence matrix for each sampling iteration, \( Z_{iter} \). Each \( Z_{iter} \) can be ordinated to provide a distribution of incidence matrices that represent estimates of true occupancy states. In this way, one can generate a distribution of metacommunity structure, rather than a single estimate for a given dataset. </p>

<p>For example, we simulated occupancy of 10 species at 50 sites using known metacommunity-level hyperparameters for species-specific detection and occurrence probabilities. In order to acheive coherence, we assumed that species&#39; occupancy responded to a single continuous covariate, with species-specific effects assigned with hyperparameters, forming a unimodal distribution of covariate effects. For now we assumed no covariate effects on detection probability. All code and documentation for this and the following simulations can be found at (<strong>github link</strong>). </p>

<p>In Figure 1, we show the ordinated matrix of raw data juxtaposed to a heat map that represents realizations of the ordinated \( Z_{iter} \) matrices. For computational tractability, we randomly sampled 100 \( Z_{iter} \) from the full posterior sample. The heat map allows us to see the range of likely ordinated matrices, given that some species are likely to go undetected during some surveys. Next, for each of the 100 posterior matrices, we ordinated the matrix and then calculated the three elements of metacommunity structure using 1000 null matrix simulations. In this way, we were able to generate Bayesian posterior estimates for each element of structure (Figure 2). (<strong>Maybe a figure that shows how average detection prob. influences variance of EMS estimates?</strong>). This approach allows us to fully understand the influence of detection on our ability to assign metacommunity structure and therefore understand the extent of type I and type II errors. </p>

<p>Another issue with the EMS strategy that can be emeliorated by a merger with occupancy modeling is the way in which covariate effects are explored. As discussed above, many researchers extract the ordination scores for sites along the first ordination axis and associate these scores to any number of covariates using univariate correlation tests. This approach is flawed in that conducting so many tests under the same type II error rate (\( \alpha \)-value) increases the chance of type I errors. </p>

<p>\newpage</p>

<h2>References</h2>

</body>

</html>

